<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Informasi Stok Bahan Ajar</title>
    <link rel="stylesheet" href="../css/stok.css" />
    <link rel="stylesheet" href="../css/dashboard.css" />
  </head>
  <body>
    <!-- Navigasi Utama -->
    <nav class="navbar">
      <ul>
        <li><a href="dashboard.html">Dashboard</a></li>
        <li><a href="stok.html" class="active">Informasi Bahan Ajar</a></li>
        <li><a href="tracking.html">Tracking Pengiriman</a></li>
        <li class="right">
          <a href="login.html" class="logout-btn">Logout</a>
        </li>
      </ul>
    </nav>

    <!-- Header -->
    <header class="stok-header">
      <h1>Informasi Stok Bahan Ajar</h1>
    </header>

    <!-- CONTAINER VUE -->
    <div id="app">
      <!-- FILTER & SORT -->
      <div class="filter-container styled-filter-box">
        <div class="filter-header">
          <h3>ðŸ“¦ Filter & Sorting Stock Bahan Ajar</h3>
          <button class="btn-reset" @click="resetFilter">ðŸ”„ Reset</button>
        </div>

        <div class="filter-grid">
          <div class="filter-item">
            <label><i class="fas fa-map-marker-alt"></i> UT-Daerah</label>
            <select v-model="selectedUpbjj" class="filter-input">
              <option value="">Semua</option>
              <option v-for="u in upbjjList" :key="u">{{ u }}</option>
            </select>
          </div>

          <div class="filter-item">
            <label><i class="fas fa-list-alt"></i> Kategori</label>
            <select v-model="selectedKategori" class="filter-input">
              <option value="">Semua</option>
              <option v-if="!selectedUpbjj" disabled>
                -- Pilih UPBJJ terlebih dahulu --
              </option>
              <option
                v-for="k in kategoriListForSelectedUpbjj"
                :key="k"
                v-if="selectedUpbjj"
              >
                {{ k }}
              </option>
            </select>
          </div>

          <div class="filter-item">
            <label><i class="fas fa-sort-amount-up"></i> Urutkan</label>
            <select v-model="sortBy" class="filter-input">
              <option value="">Default</option>
              <option value="judul">Nama Mata Kuliah (Aâ†’Z)</option>
              <option value="qty">Stok (Qty) - ascending</option>
              <option value="harga">Harga - ascending</option>
            </select>
          </div>

          <div class="filter-item checkbox-group">
            <label class="checkbox-label checkbox-label-menipis">
              <input type="checkbox" v-model="filterMenipis" />
              ðŸŸ§ Stok Menipis
            </label>
          </div>

          <div class="filter-item checkbox-group">
            <label class="checkbox-label checkbox-label-habis">
              <input type="checkbox" v-model="filterHabis" />
              ðŸ”´ Stok Habis
            </label>
          </div>
        </div>
      </div>

      <!-- TABLE -->
      <section class="stok-container">
        <table id="tabelStok">
          <thead>
            <tr>
              <th>Kode Mata Kuliah</th>
              <th>Nama Mata Kuliah</th>
              <th>Kategori</th>
              <th>UT-Daerah</th>
              <th>Lokasi Rak</th>
              <th>Harga</th>
              <th>Jumlah Stok</th>
              <th>Safety Stok</th>
              <th>Status</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="(item, idx) in filteredData" :key="item.kode">
              <td>{{ item.kode }}</td>
              <td>{{ item.judul }}</td>
              <td>{{ item.kategori }}</td>
              <td>{{ item.upbjj }}</td>
              <td>{{ item.lokasiRak }}</td>
              <td>{{ formatCurrency(item.harga) }}</td>
              <td>{{ formatQty(item.qty) }}</td>
              <td>{{ formatQty(item.safety) }}</td>
              <td style="position: relative">
                <!-- status with tooltip on hover -->
                <span
                  v-html="getStatusHtml(item)"
                  @mouseenter="showNotePreview($event, item.catatanHTML)"
                  @mouseleave="hideNotePreview"
                ></span>
              </td>
              <td class="table-actions">
                <button class="btn-primary" @click="openEditModal(idx)">
                  Update
                </button>
<button class="btn-delete" @click="confirmDelete(idx)">
  Delete
</button>

              </td>
            </tr>
            <tr v-if="filteredData.length === 0">
              <td colspan="10" style="text-align: center; padding: 14px">
                Tidak ada data.
              </td>
            </tr>
          </tbody>
        </table>

        <!-- TOMBOL MODAL -->
        <div style="margin-top: 20px">
          <button class="btn-primary" @click="openAddModal()">
            + Tambah Stok Baru
          </button>
        </div>
      </section>

      <!-- MODAL (ADD / EDIT) -->
      <div v-if="showModal" class="modal-overlay" @click.self="closeModal">
        <div class="modal-box" role="dialog" aria-modal="true">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
            "
          >
            <h3>{{ isEditing ? 'Update Stok' : 'Tambah Stok Baru' }}</h3>
            <button @click="closeModal">âœ•</button>
          </div>
          <form @submit.prevent="submitForm" class="form-horizontal">
            <div class="form-row">
              <label>Kode Mata Kuliah</label>
              <input v-model="form.kode" type="text" required />
            </div>

            <div class="form-row">
              <label>Nama Mata Kuliah</label>
              <input v-model="form.judul" type="text" required />
            </div>

            <div class="form-row">
              <label>Kategori Mata Kuliah</label>
              <input v-model="form.kategori" type="text" required />
            </div>

            <div class="form-row">
              <label>UPBJJ (UT-Daerah)</label>
              <input v-model="form.upbjj" type="text" required />
            </div>

            <div class="form-row">
              <label>Lokasi Rak</label>
              <input v-model="form.lokasiRak" type="text" required />
            </div>

            <div class="form-row">
              <label>Harga (angka)</label>
              <input v-model.number="form.harga" type="number" required />
            </div>

            <div class="form-row">
              <label>Jumlah Stok</label>
              <input v-model.number="form.qty" type="number" required />
            </div>

            <div class="form-row">
              <label>Safety Stok</label>
              <input v-model.number="form.safety" type="number" required />
            </div>

            <div class="form-row">
              <label>Catatan (tooltip)</label>
              <input v-model="form.catatanHTML" type="text" />
            </div>

            <div class="button-row">
              <button type="button" class="btn-secondary" @click="closeModal">
                Batal
              </button>
              <button type="submit" class="btn-primary">
                {{ isEditing ? 'Update' : 'Simpan' }}
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- tooltip preview -->
      <div
        v-if="tooltip.visible"
        :style="{ top: tooltip.y + 'px', left: tooltip.x + 'px' }"
        class="tooltip-preview"
        v-html="tooltip.html"
      ></div>
    </div>

    <!-- SCRIPTS -->
    <script src="../js/dataBahanAjar.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="../js/stok-app.js"></script>
  </body>
</html>
